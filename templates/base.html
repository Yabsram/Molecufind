<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kinase Schrodinger Stack the Future 2026">
    <meta name="keywords" content="hackathon schrodinger">
    <title>

      {% block title %}
        MolecuFind
      {% endblock title %}

    </title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>

  <body>
    <header>
      <a href="{{ url_for('select_property') }}" class="header-link">
        <img src="{{ url_for('static', filename='teamLogo.png') }}"
            alt="Our Logo"
            width="60"
            height="60">
        <h1>MolecuFind</h1>
      </a>
    </header>

    <hr class="divider">

    <h6 class="subheader"> Select your Properties </h6>

    <form method="post"
          action="{{ url_for('select_property') }}"
          class="select-form">

      <!-- AMW -->
      <div class="checkbox-group {% if selected.get('Molecular Weight') %}checked{% endif %}">
        <label>
          <input type="checkbox"
                 name="amw"
                 value="1"
                 {% if selected.get('Molecular Weight') %}checked{% endif %}>
          Atomic Molecular Weight (AMW)
        </label>
        <div class="number-input">
          <input type="number"
                 name="amw_value"
                 placeholder="Enter a value"
                 step="0.01"
                 value="{{ selected.get('Molecular Weight', '') }}">
        </div>
      </div>

      <!-- Crippen logP -->
      <div class="checkbox-group {% if selected.get('Lipophilicity') %}checked{% endif %}">
        <label>
          <input type="checkbox"
                 name="clogp"
                 value="2"
                 {% if selected.get('Lipophilicity') %}checked{% endif %}>
          Crippen logP
        </label>
        <div class="number-input">
          <input type="number"
                 name="clogp_value"
                 placeholder="Enter a value"
                 step="0.01"
                 value="{{ selected.get('Lipophilicity', '') }}">
        </div>
      </div>

      <!-- TPSA -->
      <div class="checkbox-group {% if selected.get('Polar Surface Area') %}checked{% endif %}">
        <label>
          <input type="checkbox"
                 name="tpsa"
                 value="3"
                 {% if selected.get('Polar Surface Area') %}checked{% endif %}>
          Topological Polar Surface Area (TPSA)
        </label>
        <div class="number-input">
          <input type="number"
                 name="tpsa_value"
                 placeholder="Enter a value"
                 step="0.01"
                 value="{{ selected.get('Polar Surface Area', '') }}">
        </div>
      </div>

      <!-- Number of Heavy Atoms -->
      <div class="checkbox-group {% if selected.get('Heavy Atoms') %}checked{% endif %}">
        <label>
          <input type="checkbox"
                 name="numHeavyAtoms"
                 value="4"
                 {% if selected.get('Heavy Atoms') %}checked{% endif %}>
          Number of Heavy Atoms
        </label>
        <div class="number-input">
          <input type="number"
                 name="numHeavyAtoms_value"
                 placeholder="Enter a value"
                 step="0.01"
                 value="{{ selected.get('Heavy Atoms', '') }}">
        </div>
      </div>

      <!-- Number of Aromatic Rings -->
      <div class="checkbox-group {% if selected.get('Aromatic Rings') %}checked{% endif %}">
        <label>
          <input type="checkbox"
                 name="numAromaticRings"
                 value="5"
                 {% if selected.get('Aromatic Rings') %}checked{% endif %}>
          Number of Aromatic Rings
        </label>
        <div class="number-input">
          <input type="number"
                 name="numaromaticrings_value"
                 placeholder="Enter a value"
                 step="0.01"
                 value="{{ selected.get('Aromatic Rings', '') }}">
        </div>
      </div>

      <button type="submit" id="search-btn">Submit</button>
    </form>

    {% if selected %}

      <hr class="divider">

      <section class="results">
        <h6 class="subheader">Property Information</h6>
        <ul>
          {% for key, value in selected.items() %}<li class="filter">{{ key }}: {{ value }}</li>{% endfor %}
        </ul>
      </section>

      <hr class="divider">

      <section class="molecule-cards">
        <h6 class="subheader">Top 20 Molecule Results</h6>
        <div class="card-grid">
          {% if results is not none %}
            {% for _, molecule in results.iterrows() %}
              <div class="card">
                <img src="{{ url_for("static", filename="images/" + molecule['Name'] + ".png") }}"
                     alt="{{ molecule['Name'] }} +  Image"
                     width="150"
                     height="150">
                <p>{{ molecule['Name'] }}</p>
                <button type="button" 
                        class="info-btn"
                        data-name="{{ molecule['Name'] }}"
                        data-image="{{ url_for('static', filename='images/' + molecule['Name'] + '.png') }}"
                        data-mw="{{ molecule['Molecular Weight'] }}"
                        data-logp="{{ molecule['Lipophilicity'] }}"
                        data-tpsa="{{ molecule['Polar Surface Area'] }}"
                        data-heavy="{{ molecule['Heavy Atoms'] }}"
                        data-aromatic="{{ molecule['Aromatic Rings'] }}">
                  More Info
                </button>
              </div>
            {% endfor %}
          {% endif %}
        </div>
    </section>

    <!-- Popup -->
    <div id="popup" class="popup-modal">
      <div class="popup-content">
        <span id="close-popup">x</span>
        <img id="popup-image" src="{{ url_for('static', filename='favicon.svg') }}" alt="Molecule Image" width="150" height="150">
        <p id="popup-title">Name here</p>
        <div class="comparison-chart">
          <div class="comparison-column">
              <p class="column-title">Inputted Values</p>
              <ul class="inputted-info">
                {% for key, value in selected.items() %}
                  <li>{{ key }}: {{ value }}</li>
                {% endfor %}
              </ul>
            </div>
          <div class="comparison-column">
              <p class="column-title">Actual Values</p>
                <ul class="inputted-info" id="actual-values">
              </ul>
          </div>
        </div>
      </div>
    </div>

    {% endif %}

    <hr class="divider">

    <footer>
      <img src="{{ url_for("static", filename="teamLogo.png") }}"
           alt="Our Logo"
           width="60"
           height="60">
      <div>
        <p>Made by Team Kinase</p>
        <p>Tiffany, Thuy Vi, Nathalie, and Yabby ðŸ’™</p>
      </div>
    </footer>

    <script>
    // Show/hide number input based on checkbox state
    document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(function(checkbox) {
      checkbox.addEventListener('change', function() {
        const numberInput = this.closest('.checkbox-group').querySelector('.number-input');
        if (this.checked) {
          numberInput.style.display = 'block';
          numberInput.querySelector('input').focus();
        } else {
          numberInput.style.display = 'none';
        }
      });
    });

    // Popup functionality
    document.addEventListener('DOMContentLoaded', () => {
      const popup = document.getElementById('popup');
      const popupTitle = document.getElementById('popup-title');
      const popupImage = document.getElementById('popup-image');
      const closePopup = document.getElementById('close-popup');
      const actualValuesList = document.getElementById('actual-values');

      document.querySelectorAll('.info-btn').forEach(button => {
        button.addEventListener('click', () => {
          // Get data from button attributes
          const name = button.dataset.name;
          const imageSrc = button.dataset.image;
          const mw = button.dataset.mw;
          const logp = button.dataset.logp;
          const tpsa = button.dataset.tpsa;
          const heavy = button.dataset.heavy;
          const aromatic = button.dataset.aromatic;

          // Update popup content
          popupTitle.textContent = name;
          popupImage.src = imageSrc;
          popupImage.alt = name + ' Image';

          // Build the actual values list
          actualValuesList.innerHTML = `
            <li>Molecular Weight: ${mw}</li>
            <li>Lipophilicity: ${logp}</li>
            <li>Polar Surface Area: ${tpsa}</li>
            <li>Heavy Atoms: ${heavy}</li>
            <li>Aromatic Rings: ${aromatic}</li>
          `;

          popup.style.display = 'flex';
        });
      });

      closePopup.addEventListener('click', () => {
        popup.style.display = 'none';
      });

      window.addEventListener('click', (e) => {
        if (e.target === popup) {
          popup.style.display = 'none';
        }
      });
    });

    // Loading overlay functionality
    document.addEventListener('DOMContentLoaded', () => {
      const loadingOverlay = document.getElementById('loading-overlay');
      const dots = document.getElementById('loading-dots');
      const searchBtn = document.getElementById('search-btn');

      let dotCount = 0;
      let intervalId = null;

      function startLoadingAnimation() {
        if (intervalId) return;
        intervalId = setInterval(() => {
          dotCount = (dotCount + 1) % 4;
          dots.textContent = '.'.repeat(dotCount);
        }, 500);
      }

      searchBtn.addEventListener('click', () => {
        loadingOverlay.style.display = 'flex';
        startLoadingAnimation();
      });
    });
    
  </script>

    <div id="loading-overlay">
      <div class="loading-content">
        <img src="{{ url_for('static', filename='teamLogoTransparent.png') }}" alt="Logo" class="loading-logo" height="75px" width="75px">
        <p class="loading-text">
          Loading<span id="loading-dots">...</span>
        </p>
      </div>
    </div>

  </body>
</html>
